<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Game Schedule</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@5.11.3/main.min.css">
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
        #calendar { margin-top: 20px; }
        .loading { text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <h1>âš½ Team Game Schedule</h1>
    <div id="loading" class="loading">Loading schedule...</div>
    <div id="calendar"></div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@5.11.3/main.global.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const calendarEl = document.getElementById('calendar');
            const loadingEl = document.getElementById('loading');
            
            // Initialize calendar
            const calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: [FullCalendar.dayGridPlugin],
                initialView: 'dayGridMonth',
                height: 'auto'
            });
            
            try {
                // Fetch events through a CORS proxy
                const response = await fetch('https://api.allorigins.win/get?url=' + 
                    encodeURIComponent('https://api.playmetrics.com/calendar/564/team/228854-51FC1D4E.ics?filter=games'));
                
                const data = await response.json();
                const icsData = data.contents;
                
                // Parse ICS manually (simple example)
                const events = parseICSEvents(icsData);
                calendar.addEventSource(events);
                
                calendar.render();
                loadingEl.style.display = 'none';
            } catch (error) {
                loadingEl.innerHTML = 'Failed to load schedule. Please try again later.';
                console.error(error);
            }
        });
        
        function parseICSEvents(icsData) {
            // Simple ICS parser - in production use a library like ical.js
            const events = [];
            const lines = icsData.split('\n');
            
            let currentEvent = {};
            for (const line of lines) {
                if (line.startsWith('BEGIN:VEVENT')) {
                    currentEvent = {};
                } else if (line.startsWith('DTSTART')) {
                    currentEvent.start = new Date(line.split(':')[1]);
                } else if (line.startsWith('SUMMARY')) {
                    currentEvent.title = line.split(':')[1];
                } else if (line.startsWith('END:VEVENT')) {
                    events.push(currentEvent);
                }
            }
            
            return events;
        }
    </script>
</body>
</html>
